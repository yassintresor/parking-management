version: '3.8'

services:
  # MySQL Database
  db:
    image: mysql:8.0
    container_name: parking_db
    restart: always
    environment:
      MYSQL_DATABASE: parking_db
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_USER: parking_user
      MYSQL_PASSWORD: parking_password
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
      - ./Schema.sql:/docker-entrypoint-initdb.d/schema.sql

  # Backend API
  backend:
    build: ./Backend
    container_name: parking_backend
    restart: always
    environment:
      DB_HOST: db
      DB_USER: parking_user
      DB_PASSWORD: parking_password
      DB_NAME: parking_db
      JWT_SECRET: parking_management_secret_key
      JWT_EXPIRE: 7d
    ports:
      - "3000:3000"
    depends_on:
      - db
    volumes:
      - ./Backend:/app
      - /app/node_modules

  # Frontend (to be added later)
  # frontend:
  #   build: ./Frontend
  #   container_name: parking_frontend
  #   restart: always
  #   ports:
  #     - "3001:3000"
  #   depends_on:
  #     - backend

volumes:
  db_data: